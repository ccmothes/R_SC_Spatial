---
title: Intermediate Spatial Analysis in R - day 2
author: carverd@colostate.edu; contributors @ github (ecarcelen, habpippin)
output:
  html_document:
  code_folding: hide
highlight: tango
theme: yeti
toc: no
toc_depth: 4
toc_float:
  collapsed: yes
smooth_scroll: yes
---

```{r setup, echo = FALSE}
# set some standard parameter for the documents. 
knitr::opts_chunk$set(echo = TRUE, message=FALSE, warning=FALSE)
```

# The Goal : run the RMD across multiple counties 

To render a RMD file from a script you can use the following function 

```{r, eval=FALSE}
# provide a path to the file and an output location 
rmarkdown::render(input = "F:/R_SC_Spatial/intermediateGeospatialR/src/countySummaries.Rmd",
                  output_file="F:/R_SC_Spatial/intermediateGeospatialR/src/summary_test")
```
This works because we have declare the baseDir, county, filters, and months parameters within the RMD. This is nice, but in order to run the process on a different county we would have to open that .rmd edit those parameters, save the file, then open this file back up, change the output name and call the render function again. Sounds boring right! 

What happens when we redefine those parameters in the this script then call the function again 

```{r}
# input features 
baseDir <- "F:/R_SC_Spatial/intermediateGeospatialR/"
county <- "Harris"
months <- c("april", "may", "june", "july")
filters <- c(2,3,4,6,10)


# provide a path to the file and an output lication 
rmarkdown::render(input = "F:/R_SC_Spatial/intermediateGeospatialR/src/countySummaries.Rmd",
                  output_file="F:/R_SC_Spatial/intermediateGeospatialR/src/summary_test_ 2")
```
The function runs but the output remains the same. This is because all those parameters we define in the script were redefined when we ran the rmd. Maybe we just need to comment out that section in the RMD. 

**Open the file and comment out the second code block**  

```{r}
# input features 
baseDir <- "F:/R_SC_Spatial/intermediateGeospatialR/"
county <- "Harris"
months <- c("april", "may", "june", "july")
filters <- c(2,3,4,6,10)


# provide a path to the file and an output lication 
rmarkdown::render(input = "F:/R_SC_Spatial/intermediateGeospatialR/src/countySummaries.Rmd",
                  output_file="F:/R_SC_Spatial/intermediateGeospatialR/src/summary_test_3")
```
Great that seemed to work. We now have data for Harris county and the filter levels and months have changed. One last test to look at, can we change these parameters with in a loop? 

```{r, eval=FALSE}
# input features : these all stay the same for each county so we can leave them as is 
baseDir <- "F:/R_SC_Spatial/intermediateGeospatialR/"
months <- c("april", "may", "june", "july")
filters <- c(2,3,4,6,10)
# create a vector of county names to loop over 
counties <- c("Bexar", "Brazoria", "Harris")

for(i in counties ){
  print(i)
  # define the county based on place in the loop 
  county <- i
  # provide a path to the file and an output lication
  ## edit the output path to distingush output based on location 
  rmarkdown::render(input = "F:/R_SC_Spatial/intermediateGeospatialR/src/countySummaries.Rmd",
                  output_file=paste0("F:/R_SC_Spatial/intermediateGeospatialR/src/summary_test_",i))
}
  
```

This worked as expect! We can now change input parameters and run this summary over any location we have data for. The great part about this is that we can add maps and other visualations to this document and the needs of the project changes over time. This same structure can be used to report out final results well. 


## tying this back to the initial question 

These figure show us the we would probably need to make idividual filter levels for each county. If we wanted to implement that filter in our original workflow we would need to add the masking process we use in code block starting on line 288 in `day2_workflow.Rmd` within the code block starting on line 771 in `mainWorkflow.rmd`. This would remove locations where the monthly average was 



